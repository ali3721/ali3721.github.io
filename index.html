import React, { useState, useMemo, useCallback } from 'react';
import { Search, Globe, BookOpen, Code, Camera, Gamepad2, Music, ShoppingBag, Utensils, Heart, Users, Zap, Award, TrendingUp, Building, Leaf, Shield, Headphones, MapPin, Plane, Car } from 'lucide-react';

const App = () => {
  // 生成示例分类数据
  const categories = [
    { id: 'all', name: '全部网站', icon: Globe, color: 'bg-blue-500' },
    { id: 'tech', name: '科技技术', icon: Code, color: 'bg-purple-500' },
    { id: 'news', name: '新闻媒体', icon: BookOpen, color: 'bg-red-500' },
    { id: 'social', name: '社交媒体', icon: Users, color: 'bg-pink-500' },
    { id: 'entertainment', name: '娱乐休闲', icon: Gamepad2, color: 'bg-yellow-500' },
    { id: 'shopping', name: '购物电商', icon: ShoppingBag, color: 'bg-green-500' },
    { id: 'education', name: '教育学习', icon: Award, color: 'bg-indigo-500' },
    { id: 'finance', name: '金融财经', icon: TrendingUp, color: 'bg-emerald-500' },
    { id: 'travel', name: '旅游出行', icon: Plane, color: 'bg-cyan-500' },
    { id: 'food', name: '美食餐饮', icon: Utensils, color: 'bg-orange-500' },
    { id: 'health', name: '健康医疗', icon: Heart, color: 'bg-rose-500' },
    { id: 'business', name: '企业服务', icon: Building, color: 'bg-teal-500' },
    { id: 'design', name: '设计创意', icon: Camera, color: 'bg-violet-500' },
    { id: 'music', name: '音乐音频', icon: Music, color: 'bg-lime-500' },
    { id: 'sports', name: '体育运动', icon: Zap, color: 'bg-amber-500' },
    { id: 'environment', name: '环保生态', icon: Leaf, color: 'bg-emerald-600' },
    { id: 'security', name: '安全隐私', icon: Shield, color: 'bg-slate-500' },
    { id: 'local', name: '本地服务', icon: MapPin, color: 'bg-fuchsia-500' },
  ];

  // 生成1000+个示例网站数据
  const generateWebsites = () => {
    const websites = [];
    const siteTypes = [
      '官方网站', '学习平台', '社区论坛', '工具服务', '新闻门户', 
      '电商平台', '视频网站', '音乐平台', '社交网络', '企业服务'
    ];
    
    for (let i = 1; i <= 1000; i++) {
      const category = categories[Math.floor(Math.random() * (categories.length - 1)) + 1].id;
      const siteType = siteTypes[Math.floor(Math.random() * siteTypes.length)];
      websites.push({
        id: i,
        name: `${siteType} ${i}`,
        url: `https://example${i}.com`,
        category: category,
        description: `这是一个优秀的${siteType}网站，提供各种服务和资源`,
        icon: `https://placehold.co/40x40/4b6cb7/ffffff?text=${i % 10}`
      });
    }
    return websites;
  };

  const allWebsites = useMemo(() => generateWebsites(), []);
  
  // 状态管理
  const [selectedCategory, setSelectedCategory] = useState('all');
  const [searchTerm, setSearchTerm] = useState('');
  const [currentPage, setCurrentPage] = useState(1);
  const websitesPerPage = 50;

  // 筛选和搜索网站
  const filteredWebsites = useMemo(() => {
    let filtered = allWebsites;
    
    // 按分类筛选
    if (selectedCategory !== 'all') {
      filtered = filtered.filter(site => site.category === selectedCategory);
    }
    
    // 按搜索词过滤
    if (searchTerm) {
      const term = searchTerm.toLowerCase();
      filtered = filtered.filter(site => 
        site.name.toLowerCase().includes(term) || 
        site.description.toLowerCase().includes(term)
      );
    }
    
    return filtered;
  }, [selectedCategory, searchTerm, allWebsites]);

  // 分页处理
  const totalPages = Math.ceil(filteredWebsites.length / websitesPerPage);
  const paginatedWebsites = useMemo(() => {
    const startIndex = (currentPage - 1) * websitesPerPage;
    return filteredWebsites.slice(startIndex, startIndex + websitesPerPage);
  }, [filteredWebsites, currentPage]);

  // 处理分类选择
  const handleCategorySelect = (categoryId) => {
    setSelectedCategory(categoryId);
    setCurrentPage(1);
  };

  // 处理搜索
  const handleSearch = useCallback((e) => {
    setSearchTerm(e.target.value);
    setCurrentPage(1);
  }, []);

  // 获取分类图标
  const getCategoryIcon = (categoryId) => {
    const category = categories.find(cat => cat.id === categoryId);
    return category ? category.icon : Globe;
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex flex-col">
      {/* 顶部搜索栏 */}
      <header className="sticky top-0 z-10 bg-white/80 backdrop-blur-sm border-b border-slate-200 shadow-sm">
        <div className="max-w-7xl mx-auto px-4 py-4">
          <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div className="flex items-center gap-3">
              <div className="bg-gradient-to-r from-blue-600 to-indigo-700 p-2 rounded-xl">
                <Globe className="text-white w-6 h-6" />
              </div>
              <h1 className="text-2xl font-bold bg-gradient-to-r from-blue-600 to-indigo-700 bg-clip-text text-transparent">
                网址导航中心
              </h1>
            </div>
            
            <div className="relative w-full md:w-96">
              <div className="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                <Search className="w-5 h-5 text-slate-400" />
              </div>
              <input
                type="text"
                value={searchTerm}
                onChange={handleSearch}
                placeholder="搜索网站名称或描述..."
                className="w-full pl-10 pr-4 py-2.5 bg-slate-100 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
              />
            </div>
          </div>
        </div>
      </header>

      <div className="flex flex-1 overflow-hidden">
        {/* 左侧导航侧边栏 */}
        <aside className="w-64 bg-white border-r border-slate-200 shadow-sm flex flex-col">
          <div className="p-4">
            <h2 className="text-lg font-semibold text-slate-800 mb-3">网站分类</h2>
            <div className="space-y-1">
              {categories.map((category) => {
                const IconComponent = category.icon;
                return (
                  <button
                    key={category.id}
                    onClick={() => handleCategorySelect(category.id)}
                    className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg transition-all ${
                      selectedCategory === category.id
                        ? 'bg-blue-100 text-blue-700 font-medium'
                        : 'text-slate-600 hover:bg-slate-100'
                    }`}
                  >
                    <div className={`${category.color} p-1.5 rounded-lg`}>
                      <IconComponent className="w-4 h-4 text-white" />
                    </div>
                    <span className="truncate">{category.name}</span>
                    {selectedCategory === category.id && (
                      <span className="ml-auto text-xs bg-blue-500 text-white px-2 py-0.5 rounded-full">
                        {category.id === 'all' 
                          ? allWebsites.length 
                          : allWebsites.filter(w => w.category === category.id).length}
                      </span>
                    )}
                  </button>
                );
              })}
            </div>
          </div>
          
          <div className="mt-auto p-4 border-t border-slate-200">
            <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4">
              <p className="text-sm text-slate-600">
                <span className="font-medium text-blue-700">总计:</span> {allWebsites.length} 个网站
              </p>
              <p className="text-sm text-slate-600 mt-1">
                <span className="font-medium text-blue-700">当前:</span> {filteredWebsites.length} 个
              </p>
            </div>
          </div>
        </aside>

        {/* 右侧网址列表 */}
        <main className="flex-1 overflow-auto p-6">
          <div className="max-w-7xl mx-auto">
            {/* 列表头部 */}
            <div className="mb-6">
              <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                  <h2 className="text-xl font-bold text-slate-800">
                    {selectedCategory === 'all' ? '所有网站' : categories.find(c => c.id === selectedCategory)?.name}
                  </h2>
                  <p className="text-slate-600 mt-1">
                    共找到 <span className="font-semibold text-blue-600">{filteredWebsites.length}</span> 个网站
                  </p>
                </div>
                
                <div className="text-sm text-slate-600">
                  每页显示 {websitesPerPage} 条 • 第 {currentPage} 页 / {totalPages} 页
                </div>
              </div>
            </div>

            {/* 网址列表 */}
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
              {paginatedWebsites.map((website) => {
                const IconComponent = getCategoryIcon(website.category);
                return (
                  <a
                    key={website.id}
                    href={website.url}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="group bg-white rounded-xl border border-slate-200 p-4 hover:shadow-lg hover:border-blue-300 transition-all duration-300 flex flex-col h-full"
                  >
                    <div className="flex items-start gap-3">
                      <div className="bg-gradient-to-br from-slate-100 to-slate-200 rounded-lg p-2 flex-shrink-0">
                        <img 
                          src={website.icon} 
                          alt={website.name}
                          className="w-10 h-10 rounded-md object-cover"
                        />
                      </div>
                      <div className="flex-1 min-w-0">
                        <h3 className="font-semibold text-slate-800 group-hover:text-blue-700 truncate">
                          {website.name}
                        </h3>
                        <p className="text-sm text-slate-500 mt-1 line-clamp-2">
                          {website.description}
                        </p>
                        <div className="mt-2 flex items-center gap-1.5">
                          <div className="flex items-center gap-1 text-xs text-slate-400">
                            <IconComponent className="w-3 h-3" />
                            <span>
                              {categories.find(c => c.id === website.category)?.name}
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div className="mt-3 pt-3 border-t border-slate-100">
                      <div className="flex items-center justify-between">
                        <span className="text-xs text-slate-500 truncate">
                          {website.url.replace('https://', '').replace('http://', '')}
                        </span>
                        <span className="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full">
                          访问
                        </span>
                      </div>
                    </div>
                  </a>
                );
              })}
            </div>

            {filteredWebsites.length === 0 && (
              <div className="text-center py-12">
                <div className="bg-slate-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                  <Search className="w-8 h-8 text-slate-400" />
                </div>
                <h3 className="text-lg font-medium text-slate-700 mb-2">未找到匹配的网站</h3>
                <p className="text-slate-500">尝试调整搜索关键词或选择其他分类</p>
              </div>
            )}

            {/* 分页控件 */}
            {totalPages > 1 && (
              <div className="mt-8 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <p className="text-sm text-slate-600">
                  显示 {Math.min((currentPage - 1) * websitesPerPage + 1, filteredWebsites.length)} - 
                  {Math.min(currentPage * websitesPerPage, filteredWebsites.length)} 条，共 {filteredWebsites.length} 条
                </p>
                
                <div className="flex items-center gap-2">
                  <button
                    onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))}
                    disabled={currentPage === 1}
                    className="px-3 py-1.5 rounded-lg border border-slate-300 text-slate-600 hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                  >
                    上一页
                  </button>
                  
                  <div className="flex gap-1">
                    {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {
                      let pageNum;
                      if (totalPages <= 5) {
                        pageNum = i + 1;
                      } else {
                        if (currentPage <= 3) {
                          pageNum = i + 1;
                        } else if (currentPage >= totalPages - 2) {
                          pageNum = totalPages - 4 + i;
                        } else {
                          pageNum = currentPage - 2 + i;
                        }
                      }
                      
                      return (
                        <button
                          key={pageNum}
                          onClick={() => setCurrentPage(pageNum)}
                          className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${
                            currentPage === pageNum
                              ? 'bg-blue-600 text-white'
                              : 'text-slate-600 hover:bg-slate-100'
                          }`}
                        >
                          {pageNum}
                        </button>
                      );
                    })}
                  </div>
                  
                  <button
                    onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))}
                    disabled={currentPage === totalPages}
                    className="px-3 py-1.5 rounded-lg border border-slate-300 text-slate-600 hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                  >
                    下一页
                  </button>
                </div>
              </div>
            )}
          </div>
        </main>
      </div>
    </div>
  );
};

export default App;
